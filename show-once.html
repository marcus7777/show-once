<link rel="import" href="../iron-localstorage/iron-localstorage.html">
<link rel="import" href="../polymer/polymer.html">
<!--
`<show-once message="Show this once" link="http://open-elemnets.org"></show-once>`
@demo demo.html
-->
<dom-module id="show-once">
  <template>
    <iron-localstorage name="{{messageHash}}" value="{{showIf}}" on-iron-localstorage-load-empty="show"></iron-localstorage>
    <template is="dom-if" if="{{showIf}}">
      <div style="position:absolute;z-index:101;top:0;left:0;right:0;background:#fde073;text-align:center;padding:10px;overflow:hidden;-webkit-box-shadow:0 0 5px black;-moz-box-shadow:0 0 5px black;box-shadow:0 0 5px black">
        <span on-tap="hide" style="float:right;padding:0 10px;">x</span>
        <content></content>
      </div>
    </template>
  </template>
</dom-module>
<script>
  Polymer({
    is: "show-once",
    properties: {
      messageHash: {computed:"hash(innerHTML)"},
      showIf: {value:false}
    },
    show: function() {
      this.showIf = true
    },
    hide: function() {
      this.showIf = false
    },
    hash: function(message) {
      var hash = 0
      if (message.length == 0) return hash
      for (i = 0;i < message.length;i++) {
        var char = message.charCodeAt(i)
        hash = ((hash<<5)-hash)+char
        hash = hash & hash // Convert to 32bit integer
      }
      return hex32(hash);
    }
  });
  
  function hex32(val) {
    val &= 0xFFFFFFFF;
    var hex = val.toString(16).toUpperCase();
    return ("00000000" + hex).slice(-8);
  }
</script>
